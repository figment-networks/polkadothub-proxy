const decodeHandlers = require('./decode_handlers');
const {createApi} = require('../tests/shared');
const fs = require('fs')

// These actually DO hit the API
describe('integration', () => {
  let api;
  let call = {request: {
    blockHash:  new Buffer.from('0x676ff6b95ca5331c1b347511a98130eba8cdd8021081d25a975b319a2a6ba117'),
    block:  new Buffer.from('"block":{"extrinsics":["0x280403000bcaba66217501","0x3902849ec81d3e582c8fc372da722fa74c321b12c88dcf5b9ef83fdbfb165719fbb55e01ba1f6a4467b30052428e882a9eaec5f76ef89d1a3cd8915fa5a2c9d901e8af59a887921d1e7f0d7e6a52f24da70f89f486fd160237f5b46b165fd1007d194b8f65019c0005007ac70caf776c8d0c2791ff1c3630817e21ce5f84224dbbab6e9c5c1acad8e04a0700e40b5402","0x5903846244e07b51d73eb164e6ca2c04366c42c5bcebffb7b8a78fd46f8804362fb05401887218bd11e375dba11167a900de365ade013a9d7809f49e6f236ad6b1ab882e2d8025a67a79e3c528b611422f98505c5086475abc69634fd7420b024ca3a786650100001a000807006244e07b51d73eb164e6ca2c04366c42c5bcebffb7b8a78fd46f8804362fb0540b0040e59c301200070508127a30e486492921e58f2564b36ab1ca21ff630672f0e76920edd601f8f2b89ad44533a4d21fd9d6f5d57c8cd05c61a6f23f9131cec8ae386b6b437db399ec3d"],"header":{"digest":{"logs":["0x0642414245b50103440000006d94eb0f000000002aff396cc357ba2e117985f0b7825e6ac23b42688e8273fa233ade756eb92a31db2bb7070207008603a9d459c883ed8c0e74fcda8938533fff2859a006c7380b9235a09e086137db276dcf4d80647f998f4d1c87ab3866da8625c2df1bb2c509","0x05424142450101ccc9d77447698e0cc31e73da58558f07039800c15904781d7475852b0052467a48ae11a36ee8f76d1842438b37480d0ae51a5011424a9f6ec525517d7e21a38b"]},"extrinsicsRoot":"0xcbca9f83ea235f3540a366278e58fe739fe3b1c417209fd97c1578ceb45a7561","number":"0x1e93da","parentHash":"0x1c467da8273cd79d75b1cdbd9e9281f1665659bab3bf1c3917b8c3e03ab43667","stateRoot":"0xd219307780efc9ff77ff22ba001baf78925fbf4becc44392ae5aceaea2d9b2e4"}},"justification":null'),
    currentEraParent:  new Buffer.from('0x85000000'),
    runtimeParent:  new Buffer.from('"apis":[["0xdf6acb689907609b",3],["0x37e397fc7c91f5e4",1],["0x40fe3ad401f8959a",4],["0xd2bc9897eed08f15",2],["0xf78b278be53f454c",2],["0xaf2c0297a23e6d3d",3],["0xed99c5acb25eedf5",2],["0xcbca25e39f142387",2],["0x687ad44ad37f03c2",1],["0xab3c0572291feb8b",1],["0xbc9d89904f5b923f",1],["0x37c8bb1350a9a2a8",1]],"authoringVersion":0,"implName":"parity-polkadot","implVersion":0,"specName":"polkadot","specVersion":24,"transactionVersion":5'),
    metadataParent: fs.read('../tests/metadata'),
    nextFeeMultiplierParent:  new Buffer.from('0x00ca9a3b000000000000000000000000'),
    timestamp:  new Buffer.from('0xcaba662175010000'),
    events:  new Buffer.from('0x3000000000000000482d7c0900000000020000000100000000037ac70caf776c8d0c2791ff1c3630817e21ce5f84224dbbab6e9c5c1acad8e04a00000100000003007ac70caf776c8d0c2791ff1c3630817e21ce5f84224dbbab6e9c5c1acad8e04a00e40b5402000000000000000000000000000100000003029ec81d3e582c8fc372da722fa74c321b12c88dcf5b9ef83fdbfb165719fbb55e7ac70caf776c8d0c2791ff1c3630817e21ce5f84224dbbab6e9c5c1acad8e04a00e40b540200000000000000000000000000010000000e0600e25707000000000000000000000000000001000000030422abc926b7b1a5a0a202183919de1089d04939e09833ca7536b52cce9fa9bf3580f8d501000000000000000000000000000001000000000088a6610b00000000000000000200000004066244e07b51d73eb164e6ca2c04366c42c5bcebffb7b8a78fd46f8804362fb0540040e59c30120000000000000000000000000200000013010000020000000e0600cac60a000000000000000000000000000002000000030422abc926b7b1a5a0a202183919de1089d04939e09833ca7536b52cce9fa9bf3580b2b1020000000000000000000000000000020000000000781d6f3c00000000000000'),
  }};

  beforeAll(async (done) => {
    api = await createApi();
    done()
  });

  describe('decode', () => {
    it('returns a result that matches snapshot', async () => {
      expect(await decodeHandlers.decode(api, call)).toMatchSnapshot();
    });
  });

});
